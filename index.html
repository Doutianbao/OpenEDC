<!DOCTYPE html>
<html class="has-navbar-fixed-top">
    <head>
        <title>OpenEDC</title>
        <meta charset="UTF-8">
        <meta name="description" content="Simple and open-source electronic data capture (EDC) system that is based entirely on the CDISC ODM-XML format.">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="theme-color" content="#ffffff">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <link rel="manifest" href="./manifest.json">
        <link rel="icon" href="./favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" sizes="180x180" href="./img/apple-touch-icon.png">
        <link rel="stylesheet" href="./lib/bulma.css">
        <link rel="stylesheet" href="./css/style.css">
        <script defer src="./lib/fontawesome-base.js"></script>
        <script defer src="./lib/fontawesome-solid.js"></script>
        <script defer src="./lib/fontawesome-regular.js"></script>
        <script defer src="./lib/crypto-js.js"></script>
        <script src="./js/app.js" type="module"></script>
    </head>
    <body>
        <nav class="navbar is-fixed-top has-shadow is-hidden">
            <div class="navbar-brand">
                <div class="navbar-item">
                    <h1 class="subtitle" id="study-title"></h1>
                </div>
                <a class="navbar-item is-hidden" id="mobile-back-button" onclick="backOnMobile()">
                    <span class="icon">
                        <i class="fas fa-chevron-left"></i>
                    </span>
                    <span>Back</span>
                </a>
                <a class="navbar-burger">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            <div class="navbar-menu">
                <div class="navbar-start">
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link" id="current-language"></a>
                        <div class="navbar-dropdown is-hidden-touch" id="language-dropdown"></div>
                    </div>
                    <a class="navbar-item" onclick="showAboutModal()">About</a>
                </div>
                <div class="navbar-end">
                    <div class="navbar-item">
                        <div class="buttons">
                            <button class="button is-white is-hidden" id="close-example-button" onclick="removeAllData()">
                                <span class="icon">
                                    <i class="fas fa-sign-out-alt"></i>
                                </span>
                                <span>Close Example</span>
                            </button>
                            <button class="button" id="project-modal-button" onclick="showProjectModal()">Project Options</button>
                            <button class="button is-link is-light" id="clinicaldata-toggle-button">
                                <span class="icon">
                                    <i class="fas fa-play"></i>
                                </span>
                                <span>Capture Data</span>
                            </button>
                            <button class="button is-link is-light is-hidden" id="metadata-toggle-button">
                                <span class="icon">
                                    <i class="fas fa-stop"></i>
                                </span>
                                <span>Model Forms</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <section class="section is-hidden" id="metadata-section">
            <div class="notification is-link is-light is-hidden-desktop">
                <h1 class="title is-4">Metadata on mobile</h1>
                <p>You are currently using a small device while editing the metadata (i.e., the forms). While this is absolutely fine and doable, we still suggest switching to a device with a larger screen to benefit from a much more simplified editing experience.</p>
            </div>
            <div class="columns is-desktop is-centered" id="details-panel">
                <div class="column is-one-fifth-desktop">
                    <div class="field">
                        <label class="label" id="element-oid-label">OID</label>
                        <input class="input" type="text" id="oid-input" autocomplete="off" disabled>
                    </div>
                    <div class="field">
                        <label class="label" id="element-short-label">Name</label>
                        <input class="input" type="text" id="name-input" autocomplete="off" disabled>
                    </div>
                    <div class="buttons is-hidden-touch">
                        <button class="button is-link" id="save-button" onclick="saveElement()" disabled>Save Changes</button>
                        <button class="button is-danger" id="remove-button" onclick="showRemoveModal()" disabled>Remove</button>
                    </div>
                </div>
                <div class="column is-one-fifth-desktop">
                    <div class="field">
                        <label class="label" id="element-long-label">Description</label>
                        <textarea class="textarea" id="question-textarea" disabled></textarea>
                    </div>
                    <div class="tags has-addons is-centered is-hidden" id="references-tag">
                        <span class="tag">Multiple references of element</span>
                        <span class="tag is-link" id="number-of-references"></span>
                      </div>
                </div>
                <div class="column is-one-fifth-desktop">
                    <div class="field">
                        <label class="label" id="datatype-label">Data Type</label>
                    </div>
                    <div class="field">
                        <label class="label" id="mandatory-label">Mandatory</label>
                    </div>
                    <div class="buttons is-pulled-right is-hidden-touch">
                        <button class="button" id="duplicate-button" onclick="showDuplicateModal()" disabled>Duplicate</button>
                        <button class="button" id="more-button" onclick="showMoreModal()" disabled>
                            <span class="icon is-small">
                                <i class="fas fa-wrench"></i>
                            </span>
                            <span>More</span>
                        </button>
                    </div>
                </div>
                <div class="column is-hidden-desktop">
                    <div class="buttons are-small">
                        <button class="button is-link" id="save-button-mobile" onclick="saveElement()" disabled>Save Changes</button>
                        <button class="button is-danger" id="remove-button-mobile" onclick="showRemoveModal()" disabled>Remove</button>
                        <button class="button" id="duplicate-button-mobile" onclick="showDuplicateModal()" disabled>Duplicate</button>
                        <button class="button" id="more-button-mobile" onclick="showMoreModal()" disabled>
                            <span class="icon is-small">
                                <i class="fas fa-wrench"></i>
                            </span>
                            <span>More</span>
                        </button>
                    </div>
                </div>
            </div>
            <hr>
            <div class="columns is-desktop">
                <div class="column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered" element-type="studyevent" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Events</p>
                        <div class="tree-panel-blocks" id="study-event-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)"></div>
                        <div class="panel-block has-light-border-top" id="study-events-add-button">
                            <button class="button is-link is-light is-fullwidth" onclick="addStudyEvent()">Add</button>
                        </div>
                    </nav>
                </div>
                <div class="column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered" element-type="form" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Forms</p>
                        <div class="tree-panel-blocks" id="form-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)"></div>
                        <div class="panel-block has-light-border-top" id="forms-add-button">
                            <button class="button is-link is-light is-fullwidth" onclick="addForm()" disabled>Add</button>
                        </div>
                    </nav>
                </div>
                <div class="column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered" element-type="itemgroup" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Groups</p>
                        <div class="tree-panel-blocks" id="item-group-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)"></div>
                        <div class="panel-block has-light-border-top" id="item-groups-add-button">
                            <button class="button is-link is-light is-fullwidth" onclick="addItemGroup()" disabled>Add</button>
                        </div>
                    </nav>
                </div>
                <div class="column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered" element-type="item" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Items</p>
                        <div class="tree-panel-blocks" id="item-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)"></div>
                        <div class="panel-block has-light-border-top" id="items-add-button">
                            <button class="button is-link is-light is-fullwidth" onclick="addItem()" disabled>Add</button>
                        </div>
                    </nav>
                </div>
                <div class="column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered" element-type="codelistitem" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Choices</p>
                        <div class="tree-panel-blocks" id="code-list-item-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)"></div>
                        <div class="panel-block has-light-border-top" id="code-list-items-add-button">
                            <button class="button is-link is-light is-fullwidth" onclick="addCodeListItem()" disabled>Add</button>
                        </div>
                    </nav>
                </div>
            </div>
        </section>

        <section class="section is-hidden" id="clinicaldata-section">
            <div class="columns is-desktop">
                <div class="column" id="subjects-column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered">Subjects</p>
                        <div class="panel-block has-no-padding-bottom has-no-border-bottom">
                            <div class="field is-grouped is-fullwidth">
                                <div class="control is-expanded has-icons-left">
                                    <input class="input" id="add-subject-input" type="text" placeholder="New Subject">
                                    <span class="icon is-left">
                                        <i class="fas fa-plus"></i>
                                    </span>
                                </div>
                                <div class="control">
                                    <button class="button is-link is-light" id="add-subject-button" onclick="addSubject()">Add</button>
                                </div>
                            </div>
                        </div>
                        <div class="panel-block has-no-padding-bottom has-no-border-bottom">
                            <div class="field is-fullwidth">
                                <div class="control has-icons-left is-fullwidth" id="filter-site-control">
                                    <div class="icon">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-block has-no-padding-bottom has-no-border-bottom">
                            <div class="field is-fullwidth">
                                <div class="control has-icons-left is-fullwidth" id="sort-subject-control">
                                    <div class="icon">
                                        <i class="fas fa-sort-alpha-down"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-block has-no-padding-bottom has-no-border-bottom">
                            <div class="control has-icons-left">
                                <input class="input" id="search-subject-input" type="text" placeholder="Search">
                                <span class="icon is-left">
                                    <i class="fas fa-search"></i>
                                </span>
                            </div>
                        </div>
                        <div class="panel-block">
                            <button class="button is-small is-fullwidth" id="subject-info-button" onclick="showSubjectInfo()" disabled>Options and Audit Trail</button>
                        </div>
                        <div class="tree-panel-blocks" id="subject-panel-blocks">
                            <div class="panel-block has-text-centered has-text-grey-light" id="no-subjects-hint">
                                <p>No subjects available. Please add a new subject with the button above.</p>
                            </div>
                        </div>
                    </nav>
                </div>
                <div class="column is-hidden-touch" id="clinicaldata-study-events-column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered">Events</p>
                        <div class="tree-panel-blocks" id="clinicaldata-study-event-panel-blocks">
                        </div>
                    </nav>
                </div>
                <div class="column is-hidden-touch" id="clinicaldata-forms-column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered">Forms</p>
                        <div class="tree-panel-blocks" id="clinicaldata-form-panel-blocks">
                        </div>
                    </nav>
                </div>
                <div class="column is-two-fifths-desktop is-hidden-touch" id="clinicaldata-column">
                    <nav class="panel is-link">
                        <p class="panel-heading has-text-centered">Data</p>
                        <div class="tree-panel-blocks">
                            <div class="is-hidden" id="clinicaldata-form-data">
                                <article class="message is-danger is-hidden" id="no-subject-selected-hint">
                                    <div class="message-body" i18n="no-subject-selected-hint">No subject selected. You can still view and test the form but entered data will not be stored.</div>
                                </article>
                                <article class="message is-link is-hidden" id="audit-record-data-hint">
                                    <div class="message-body">
                                        <p i18n="audit-record-data-hint">You are currently viewing data from the audit trail.</p>
                                        <p id="audit-record-most-current-hint" i18n="audit-record-most-current-hint">This is the most current data or equivalent to the most current data.</p>
                                    </div>
                                </article>
                                <nav class="level">
                                    <div class="level-left" id="clinicaldata-form-title">
                                        <div class="level-item">
                                            <h1 class="subtitle is-3"></h1>
                                        </div>
                                    </div>
                                    <div class="level-right" id="survey-view-button">
                                        <div class="level-item">
                                            <button class="button is-small is-link is-light" onclick="showSurveyView()">
                                                <span class="icon">
                                                    <i class="fas fa-expand"></i>
                                                </span>
                                                <span i18n="survey-view">Survey View</span>
                                            </button>
                                        </div>
                                    </div>
                                </nav>
                                <hr>
                                <div id="clinicaldata-content"></div>
                                <button class="button" id="clinicaldata-close-button" onclick="cancelFormOrSurveyEntry()" i18n="close">Close</button>
                                <div class="field has-addons is-pulled-right" id="clinicaldata-navigate-buttons">
                                    <div class="control">
                                        <button class="button" id="clinicaldata-previous-button" onclick="loadPreviousFormData()" i18n="back">Back</button>
                                    </div>
                                    <div class="control">
                                        <button class="button is-link" id="clinicaldata-next-button" onclick="loadNextFormData()" i18n="continue">Continue</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </section>

        <div class="modal" id="remove-modal">
            <div class="modal-background" onclick="hideRemoveModal()"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle">Please confirm</h2>
                    <div class="notification is-danger is-hidden">You cannot currently remove this element since there is clinical data assigned to it for the following subjects: <strong></strong>.</div>
                    <p class="mb-5">The reference to the element will be removed. The element definition will be removed as well if there was no other reference to it.</p>
                    <div class="buttons is-centered">
                        <button class="button is-danger is-small" onclick="removeElement()">Remove</button>
                        <button class="button is-small" onclick="hideRemoveModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="close-clinicaldata-modal">
            <div class="modal-background" onclick="hideCloseClinicalDataModal()"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle" id="close-form-title" i18n="close-form">Close form</h2>
                    <h2 class="subtitle is-hidden" id="close-survey-title" i18n="close-survey">Close survey</h2>
                    <p class="mb-5" id="close-form-text" i18n="close-form-text">It seems that you just edited or entered new data. Do you really want to close the current form?</p>
                    <p class="is-hidden mb-5" id="close-survey-text" i18n="close-survey-text">Do you really want to end the survey?</p>
                    <div class="buttons is-centered">
                        <button class="button is-small" onclick="closeFormData()" i18n="close-without-saving">Close without saving</button>
                        <button class="button is-small" onclick="closeFormData(true)" i18n="close-with-saving">Close with saving</button>
                        <button class="button is-link is-small" onclick="hideCloseClinicalDataModal()" i18n="continue">Continue</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="duplicate-modal">
            <div class="modal-background" onclick="hideDuplicateModal()"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle">Mode of duplication</h2>
                    <p class="mb-5">It possible to either duplicate the reference to the elements definition, to create a new shallow copy with the same children references, or to recursively deep copy the element and all its descendants.</p>
                    <p class="mb-5"><strong>Hint:</strong> If you create a reference, the original element and its descendants are updated if you make changes in the new element. A shallow or deep copy lets you make changes that do not affect the original element (shallow) and its descendants (deep). In a shallow copy you can still rearrange, remove, or add direct children references without affecting the original element.</p>
                    <div class="buttons is-centered">
                        <button class="button is-small is-link" onclick="duplicateReference()">Reference</button>
                        <button class="button is-small is-link" onclick="shallowOrDeepCopy(false)">Shallow copy</button>
                        <button class="button is-small is-link" onclick="shallowOrDeepCopy(true)">Deep copy</button>
                        <button class="button is-small" onclick="hideDuplicateModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="more-modal">
            <div class="modal-background" onclick="hideMoreModal()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="tabs is-centered" id="more-tabs">
                        <ul>
                            <li class="is-active" id="element-options-tab" onclick="moreTabClicked(event)"><a>Element Options</a></li>
                            <li id="element-description-tab" onclick="moreTabClicked(event)"><a>Description</a></li>
                            <li id="conditions-tab" onclick="moreTabClicked(event)"><a>Conditions</a></li>
                            <li id="measurement-units-tab" onclick="moreTabClicked(event)"><a>Measurement Units</a></li>
                        </ul>
                    </div>
                    <div class="width-is-three-quarters" id="element-options">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Element Options</h1>
                            <p>The following panel lets you configure further options for the currently selected element. New collection exception conditions and measurement units can be added via the tabs above.</p>
                        </div>
                        <div class="field">
                            <label class="label" id="condition-label">Collection Exception Condition</label>
                        </div>
                        <div class="field">
                            <label class="label" id="measurement-unit-label">Measurement Unit</label>
                        </div>
                        <label class="label" id="range-check-label">Range Check</label>
                        <button class="button is-small is-pulled-right" id="add-range-check-button" onclick="addRangeCheckInput()">+</button>
                        <br>
                        <label class="label" id="alias-label">Alias</label>
                        <div class="buttons is-pulled-right are-small">
                            <button class="button" onclick="addAliasInput()">+</button>
                        </div>
                    </div>
                    <div class="width-is-three-quarters is-hidden" id="element-description">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Description</h1>
                            <p>This system is built for good usability while also encouraging best practices. Therefore, the main details panel does not show the description of an item but its question instead. If required, the description of an item can be edited here.</p>
                        </div>
                        <label class="label" id="element-description-label">Description</label>
                        <textarea class="textarea" id="element-description-textarea"></textarea>
                    </div>
                    <div class="width-is-three-quarters is-hidden" id="conditions">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Conditions</h1>
                            <p>Conditions are used to define a collection exception for an item. The system automatically hides an item if the specified condition evaluates to true. <strong>Example:</strong> To hide an item with the OID <i>diabetes_therapy</i> if the value of the item with the OID <i>diagnosis</i> is not set to <i>diabetes</i>, enter <i><u>diagnosis != "diabetes"</u></i> and reference it in the <i>diabetes_therapy</i> item.</p>
                        </div>
                        <label class="label" id="conditions-label">Collection Exception Conditions</label>
                        <button class="button is-small is-pulled-right" onclick="addConditionInput()">+</button>
                    </div>
                    <div class="width-is-three-quarters is-hidden" id="measurement-units">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Measurement Units</h1>
                            <p>Measurement units defined here are available for every item in every event. The symbol is a translated text and corresponds to the current selected language.</p>
                        </div>
                        <label class="label" id="measurement-units-label">Measurement Units</label>
                        <button class="button is-small is-pulled-right" onclick="addMeasurementUnitInput()">+</button>
                    </div>
                    <div class="width-is-three-quarters mt-6">
                        <div class="buttons">
                            <button class="button is-link" id="save-more-button" onclick="saveMoreModal()">Save Changes</button>
                            <button class="button" id="cancel-more-button" onclick="hideMoreModal()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="start-modal">
            <div class="modal-background"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="width-is-two-thirds">
                        <h1 class="title">OpenEDC – Start</h1>
                        <h2 class="subtitle">Please choose a starting point</h2>
                        <hr>
                        <p class="mb-5">This free and <a target="_blank" href="#">open-source</a> electronic data capture (EDC) system lets you create and conduct secure clinical research studies based on the <a target="_blank" href="https://www.cdisc.org/standards/data-exchange/odm">CDISC ODM-XML</a> format.</p>
                        <p class="mb-5">All data is entirely processed on your local device. No data is ever send to our server. You can optionally connect to your own <a target="_blank" href="#">OpenEDC Server</a> to simply create multi-centric research studies with multiple users.</p>
                        <p class="mb-5">For an empty project, choose <strong>New Project</strong>. Click <strong>Open</strong> if you have an ODM-XML file on your computer. If you have not yet used this EDC system, choose <strong>Example</strong> to load an exemplary project and see how it all works.</p>
                        <div class="buttons is-centered">
                            <button class="button" onclick="newProject()">New Project</button>
                            <div class="file">
                                <label class="file-label">
                                    <input class="file-input" type="file" name="resume" id="odm-upload" onchange="uploadODM()">
                                    <span class="file-cta">
                                        <span class="file-label">Open</span>
                                    </span>
                                </label>
                            </div>
                            <button class="button" onclick="loadExample()">Example</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="project-modal">
            <div class="modal-background" onclick="hideProjectModal()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="tabs is-centered" id="project-tabs">
                        <ul>
                            <li class="is-active" id="general-options-tab" onclick="projectTabClicked(event)"><a>General Options</a></li>
                            <li id="users-options-tab" onclick="projectTabClicked(event)"><a>Users</a></li>
                            <li id="sites-options-tab" onclick="projectTabClicked(event)"><a>Sites</a></li>
                            <li id="name-description-tab" onclick="projectTabClicked(event)"><a>Name and Description</a></li>
                        </ul>
                    </div>
                    <div class="width-is-three-quarters" id="general-options">
                        <div class="notification is-link is-light" id="connect-to-server-option">
                            <h1 class="title is-4">Connect to Server</h1>
                            <p class="mb-5 is-hidden" id="server-connected-hint"><strong>You are connected to an OpenEDC Server.</strong></p>
                            <p class="mb-5">With this option you can connect to an OpenEDC Server. This lets you create projects with multiple users. This also backups all data for you automatically. All data is end-to-end encrypted by default.</p>
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    <input class="input is-small" id="server-url-input" type="text" placeholder="Server URL">
                                </div>
                                <div class="control">
                                    <a class="button is-link is-small" onclick="connectToServer()">Connect</a>
                                </div>
                            </div>
                            <form class="is-hidden" id="initialize-server-form">
                                <p class="mb-5"><strong>A new OpenEDC Server could be found. You can now create an account for the server.</strong></p>
                                <input class="input is-small mb-3" id="owner-username-input" type="text" placeholder="Username" autocomplete="username">
                                <input class="input is-small mb-3" id="owner-password-input" type="password" placeholder="Password" autocomplete="new-password">
                                <input class="input is-small mb-5" id="owner-confirm-password-input" type="password" placeholder="Password (confirm)" autocomplete="new-password">
                                <button class="button is-link is-small" onclick="initializeServer(event)">Create user</button>
                            </form>
                        </div>
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Encrypt Data</h1>
                            <p class="mb-5 is-hidden" id="data-encrypted-hint"><strong>Data is encrypted.</strong></p>
                            <p class="mb-5">With this option you can fully encrypt all locally stored data. All currently stored and future data will then be encrypted. When you open the app again, you need to enter the password to decrypt the data.</p>
                            <p class="mb-5" id="data-encryption-warning"><strong>Warning: If you forget the password, all data will be permanently lost.</strong></p>
                            <form>
                                <input class="is-hidden mb-5" autocomplete="username">
                                <div class="field has-addons">
                                    <div class="control is-expanded">
                                        <input class="input is-small" id="encryption-password-input" type="password" placeholder="Encryption password" autocomplete="new-password">
                                    </div>
                                    <div class="control">
                                        <a class="button is-link is-small" onclick="encryptData()">Encrypt</a>
                                    </div>
                                </div>
                                <div class="field has-addons is-hidden">
                                    <div class="control is-expanded">
                                        <input class="input is-small" id="confirm-encryption-password-input" type="password" placeholder="Confirm encryption password" autocomplete="new-password">
                                    </div>
                                    <div class="control">
                                        <a class="button is-link is-small" onclick="encryptData()">Confirm</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Survey Code</h1>
                            <p class="mb-5">This option lets you set a four-digit numerical code that needs to be entered after a local survey (started with the <i>SurveyView</i> button) is finished or canceled. This prevents study participants from seeing foreign data.</p>
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    <input class="input is-small" id="survey-code-input" type="text" placeholder="Survey code">
                                </div>
                                <div class="control">
                                    <a class="button is-link is-small" onclick="setSurveyCode()">Set</a>
                                </div>
                            </div>
                        </div>
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Miscellaneous Options</h1>
                            <p class="mb-5">In the following, different miscellaneous options are listed that you can activate by clicking on it. If you are connect to a server, the options are valid for all users.</p>
                            <label class="checkbox mb-1">
                                <input type="checkbox" id="text-as-textarea-checkbox" oninput="miscOptionClicked(event)">
                                Render items with the datatype <i>string</i> as multi-line textareas instead of one-line inputs.
                            </label>
                            <label class="checkbox">
                                <input type="checkbox" id="auto-survey-view-checkbox" oninput="miscOptionClicked(event)">
                                Automatically open the survey view on mobile devices when clicking on a study event.
                            </label>
                        </div>
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Export Data</h1>
                            <p class="mb-5">These options lets you download the project in CDISC ODM-XML or CSV format. You can either download all data (including the metadata, admindata, and data from all subjects including the entire audit trail), or only the metadata or clinicaldata. Please note that only the first option creates a backup of your project.</p>
                            <div class="buttons">
                                <button class="button is-link is-small" onclick="downloadODM()">Download ODM (complete)</button>
                                <button class="button is-small" onclick="downloadODMMetadata()">Download ODM (only metadata)</button>
                                <button class="button is-small" onclick="downloadCSV()">Download CSV (only clinicaldata)</button>
                            </div>
                        </div>
                        <div class="notification is-danger is-light">
                            <h1 class="title is-4">Remove Data</h1>
                            <p class="mb-5">The following option lets you remove all stored data and thereby reset the current project.</p>
                            <p class="mb-5"><strong>Warning: This cannot be undone.</strong></p>
                            <div class="buttons">
                                <button class="button is-danger is-small" onclick="removeAllData()">Remove data (complete)</button>
                                <button class="button is-danger is-small" onclick="removeClinicaldata()">Remove data (only clinicaldata)</button>
                            </div>
                        </div>
                    </div>
                    <div class="width-is-three-quarters is-hidden" id="users-options">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Users</h1>
                            <p>The following panel lets you add users to the current project. Please note that you can only add new users when you are connected to an OpenEDC Server.</p>
                        </div>
                        <div class="columns">
                            <div class="column">
                                <nav class="panel">
                                    <div class="panel-block has-text-centered has-text-grey-light" id="no-users-hint">
                                        <p>No users available. Please add a new user with the button below.</p>
                                    </div>
                                    <div class="panel-block" id="add-user-button">
                                        <button class="button is-link is-light is-fullwidth" onclick="addUser()" disabled>Add User</button>
                                    </div>
                                </nav>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label">First name</label>
                                    <input class="input" id="user-first-name-input" type="text">
                                </div>
                                <div class="field">
                                    <label class="label">Last name</label>
                                    <input class="input" id="user-last-name-input" type="text">
                                </div>
                                <div class="field">
                                    <label class="label">Site</label>
                                    <div class="control" id="user-site-control"></div>
                                </div>
                                <hr>
                                <div class="field">
                                    <label class="label">Username</label>
                                    <input class="input" id="user-username-input" type="text">
                                </div>
                                <div class="field">
                                    <label class="label">Initial password</label>
                                    <input class="input" id="user-password-input" type="text">
                                </div>
                                <div class="field is-hidden" id="user-rights">
                                    <hr>
                                    <label class="label">User rights</label>
                                </div>
                                <div class="buttons">
                                    <button class="button is-link" id="user-save-button" onclick="saveUser()">Save</button>
                                    <button class="button is-danger" id="user-remove-button" onclick="removeUser()">Remove</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="width-is-three-quarters is-hidden" id="sites-options">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Sites</h1>
                            <p>With the following panel you can add and edit sites. Subjects can be assigned to sites to conduct multi-centric research projects.</p>
                        </div>
                        <div class="columns">
                            <div class="column">
                                <nav class="panel">
                                    <div class="panel-block has-text-centered has-text-grey-light" id="no-sites-hint">
                                        <p>No sites available. Please add a new site with the button below.</p>
                                    </div>
                                    <div class="panel-block" id="add-site-button">
                                        <button class="button is-link is-light is-fullwidth" onclick="addSite()">Add Site</button>
                                    </div>
                                </nav>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label">Name</label>
                                    <input class="input" id="site-name-input" type="text">
                                </div>
                                <div class="buttons">
                                    <button class="button is-link" id="site-save-button" onclick="saveSite()">Save</button>
                                    <button class="button is-danger" id="site-remove-button" onclick="removeSite()">Remove</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="width-is-three-quarters is-hidden" id="name-description">
                        <div class="notification is-link is-light">
                            <h1 class="title is-4">Name and Description</h1>
                            <p>The following panel lets you edit the study name, study description, and protocol name. The study name will be displayed in the top navigation bar of this app.</p>
                        </div>
                        <div class="field">
                            <label class="label">Study name</label>
                            <input class="input" id="study-name-input" type="text">
                        </div>
                        <div class="field">
                            <label class="label">Study description</label>
                            <textarea class="textarea" id="study-description-textarea"></textarea>
                        </div>
                        <div class="field">
                            <label class="label">Protocol name</label>
                            <input class="input" id="protocol-name-input" type="text">
                        </div>
                        <div class="buttons">
                            <button class="button is-link" id="save-global-variables-button" onclick="saveStudyNameDescription()">Save Changes</button>
                            <button class="button" id="cancel-global-variables-button" onclick="hideProjectModal()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="subject-modal">
            <div class="modal-background" onclick="hideSubjectInfo()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="width-is-two-thirds">
                        <h1 class="title">Options and Audit Trail</h1>
                        <h2 class="subtitle">of Subject: <strong></strong></h2>
                        <hr>
                        <h2 class="subtitle">Subject Options</h2>
                        <div class="field">
                            <label class="label">Key</label>
                            <div class="control">
                                <input class="input" id="subject-key-input" type="text">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Site</label>
                            <div class="control" id="subject-site-control"></div>
                        </div>
                        <div class="buttons">
                            <button class="button is-danger is-small" id="save-subject-info-button" onclick="saveSubjectInfo()">Save Changes</button>
                            <button class="button is-small" onclick="hideSubjectInfo()">Cancel</button>
                        </div>
                        <hr>
                        <h2 class="subtitle">Audit Trail</h2>
                        <div id="audit-records"></div>
                        <button class="button is-danger is-small" onclick="removeSubject()">Remove Subject</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="survey-code-modal">
            <div class="modal-background"></div>
            <div class="modal-content is-large">
                <div class="box has-text-centered">
                    <h2 class="subtitle" i18n="survey-finished">Survey finished</h2>
                    <p i18n="survey-finished-text">Thank you for taking the survey.</p>
                    <p class="mb-5" i18n="survey-finished-code-text">Please enter the survey code to close this window.</p>
                    <div class="numpad has-text-centered mb-5">
                        <hr>
                        <div class="status mb-5"></div>
                        <div class="buttons is-centered"></div>
                    </div>
                    <p class="has-text-danger is-hidden" id="wrong-survey-code-hint" i18n="wrong-survey-code-hint">Wrong code entered. Please try again.</p>
                </div>
            </div>
        </div>

        <div class="modal" id="login-modal">
            <div class="modal-background"></div>
            <div class="modal-content is-large">
                <div class="box has-text-centered">
                    <div class="width-is-two-thirds">
                        <h2 class="subtitle" id="login-title"></h2>
                        <p class="mb-5" id="login-text"></p>
                        <article class="message is-danger mb-5 is-hidden" id="login-incorrect-hint">
                            <div class="message-body"></div>
                        </article>
                        <form>
                            <div class="field">
                                <div class="control has-icons-left">
                                    <input class="input" id="username-input" type="text" autocomplete="username" placeholder="Username">
                                    <span class="icon is-small is-left">
                                        <i class="fas fa-user"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="field">
                                <div class="control has-icons-left">
                                    <input class="input" id="password-input" type="password" autocomplete="current-password" placeholder="Password">
                                    <span class="icon is-small is-left">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="field is-hidden">
                                <div class="control has-icons-left">
                                    <input class="input" id="confirm-password-input" type="password" autocomplete="current-password" placeholder="Password (confirm)">
                                    <span class="icon is-small is-left">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                </div>
                            </div>
                            <button class="button is-link mt-3" id="open-button" type="submit">Open</button>
                        </form>
                        <button class="button is-text is-small mt-3" onclick="forgotPassword()">Forgot password?</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="about-modal">
            <div class="modal-background" onclick="hideAboutModal()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="width-is-two-thirds">
                        <h1 class="title">About OpenEDC</h1>
                        <h2 class="subtitle">Simple and secure data collection</h2>
                        <hr>
                        <p class="mb-5">This free and <a target="_blank" href="#">open-source</a> electronic data capture (EDC) system lets you create and conduct secure clinical research studies based on the <a target="_blank" href="https://www.cdisc.org/standards/data-exchange/odm">CDISC ODM-XML</a> format.</p>
                        <p class="mb-5">All data is entirely processed on your local device. No data is ever send to our server. You can optionally connect to your own <a target="_blank" href="#">OpenEDC Server</a> to simply create multi-centric research studies with multiple users.</p>
                        <p class="mb-5">This EDC system is currently in a beta, but yet stable state. For any questions, bug reports, or feature requests, please contact:</p>
                        <div class="notification">
                            <p>Leonard Greulich</p>
                            <p>+49 (251) 83-54730</p>
                            <p class="mb-5"><a href="mailto:leonard.greulich@ukmuenster.de">leonard.greulich@uni-muenster.de</a></p>
                            <p><strong>Institute for Medical Informatics</strong></p>
                            <p>Director: Prof. Dr. Martin Dugas</p>
                            <p>Albert-Schweitzer-Campus 1, A11</p>
                            <p>48149 Münster, Germany</p>
                        </div>
                        <a class="button is-rounded is-small is-link mb-5" target="_blank" href="https://medical-data-models.org/imprint?lang=en#data-privacy">
                            <span class="icon">
                                <i class="fas fa-arrow-right"></i>
                            </span>
                            <span>Data Protection Policy</span>
                        </a>
                        <br>
                        <button class="button" onclick="hideAboutModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="warning-modal">
            <div class="modal-background"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle"></h2>
                    <p class="mb-5"></p>
                    <button class="button is-small is-link">Okay</button>
                </div>
            </div>
        </div>

    </body>
</html>
