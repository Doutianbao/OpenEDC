<!DOCTYPE html>
<html class="has-navbar-fixed-top">
    <head>
        <title>OpenEDC</title>
        <meta charset="UTF-8">
        <meta name="description" content="Simple and open-source electronic data capture (EDC) system that is based entirely on the CDISC ODM-XML format.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="./lib/bulma.css">
        <link rel="stylesheet" href="./css/style.css">
        <script defer src="./lib/fontawesome-base.js"></script>
        <script defer src="./lib/fontawesome-solid.js"></script>
        <script src="./js/app.js" type="module"></script>
    </head>
    <body>
        <nav class="navbar is-fixed-top has-shadow">
            <div class="navbar-brand">
                <div class="navbar-item">
                    <h1 class="subtitle" id="study-title">New Project</h1>
                </div>
                <a class="navbar-burger">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            <div class="navbar-menu">
                <div class="navbar-start">
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link" id="current-language">English</a>
                        <div class="navbar-dropdown is-hidden-mobile" id="language-dropdown">
                            <a class="navbar-item">English</a>
                        </div>
                    </div>
                    <a class="navbar-item" onclick="showAboutModal()">About</a>
                </div>
                <div class="navbar-end">
                    <div class="navbar-item">
                        <div class="buttons">
                            <button class="button" id="preview-button" onclick="showPreviewModal()" disabled>Preview Form</button>
                            <button class="button" onclick="showProjectModal()">Project Options</button>
                            <button class="button is-link is-light" id="clinicaldata-toggle-button" onclick="showClinicaldata()">
                                <span class="icon">
                                    <i class="fas fa-play"></i>
                                </span>
                                <span>Capture Data</span>
                            </button>
                            <button class="button is-link is-light is-hidden" id="metadata-toggle-button" onclick="showMetadata()">
                                <span class="icon">
                                    <i class="fas fa-stop"></i>
                                </span>
                                <span>Model Forms</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <section class="section" id="metadata-section">
            <div class="columns is-centered" id="details-panel">
                <div class="column is-one-fifth">
                    <div class="field">
                        <label class="label" id="element-oid-label">OID</label>
                        <input class="input" type="text" id="oid-input" autocomplete="off" disabled>
                    </div>
                    <div class="field">
                        <label class="label" id="element-short-label">Name</label>
                        <input class="input" type="text" id="name-input" autocomplete="off" disabled>
                    </div>
                    <div class="buttons is-hidden-mobile">
                        <button class="button is-link" id="save-button" onclick="saveElement()" disabled>Save Changes</button>
                        <button class="button is-danger" id="delete-button" onclick="showDeleteModal()" disabled>Remove</button>
                    </div>
                </div>
                <div class="column is-one-fifth">
                    <div class="field">
                        <label class="label" id="element-long-label">Description</label>
                        <textarea class="textarea" id="question-textarea" disabled></textarea>
                    </div>
                    <div class="tags has-addons is-centered is-hidden" id="references-tag">
                        <span class="tag">Multiple references of element</span>
                        <span class="tag is-link" id="number-of-references"></span>
                      </div>
                </div>
                <div class="column is-one-fifth">
                    <div class="field">
                        <label class="label" id="datatype-label">Data Type</label>
                    </div>
                    <div class="field">
                        <label class="label" id="mandatory-label">Mandatory</label>
                    </div>
                    <div class="buttons is-pulled-right is-hidden-mobile">
                        <button class="button" id="duplicate-button" onclick="showDuplicateModal()" disabled>Duplicate</button>
                        <button class="button" id="more-button" onclick="showMoreModal()" disabled>
                            <span class="icon is-small">
                                <i class="fas fa-wrench"></i>
                            </span>
                            <span>More</span>
                        </button>
                    </div>
                </div>
                <div class="column is-one-fifth is-hidden-tablet">
                    <div class="buttons">
                        <button class="button is-link" id="save-button-mobile" onclick="saveElement()" disabled>Save Changes</button>
                        <button class="button is-danger" id="delete-button-mobile" onclick="showDeleteModal()" disabled>Remove</button>
                        <button class="button" id="duplicate-button-mobile" onclick="showDuplicateModal()" disabled>Duplicate</button>
                        <button class="button" id="more-button-mobile" onclick="showMoreModal()" disabled>
                            <span class="icon is-small">
                                <i class="fas fa-wrench"></i>
                            </span>
                            <span>More</span>
                        </button>
                    </div>
                </div>
            </div>
            <hr>
            <div class="columns">
                <div class="column is-one-fifth">
                    <nav class="panel">
                        <p class="panel-heading has-text-centered" element-type="studyevent" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Events</p>
                        <div class="tree-panel-blocks" id="study-event-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">
                        </div>
                        <div class="panel-block panel-block-add" id="study-events-add-button">
                            <button class="button is-link is-fullwidth" onclick="addStudyEvent()">Add</button>
                        </div>
                    </nav>
                </div>
                <div class="column is-one-fifth">
                    <nav class="panel">
                            <p class="panel-heading has-text-centered" element-type="form" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Forms</p>
                            <div class="tree-panel-blocks" id="form-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">
                            </div>
                            <div class="panel-block panel-block-add" id="forms-add-button">
                                <button class="button is-link is-fullwidth" onclick="addForm()" disabled>Add</button>
                            </div>
                        </nav>
                </div>
                <div class="column is-one-fifth">
                    <nav class="panel">
                            <p class="panel-heading has-text-centered" element-type="itemgroup" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Groups</p>
                            <div class="tree-panel-blocks" id="item-group-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">
                            </div>
                            <div class="panel-block panel-block-add" id="item-groups-add-button">
                                <button class="button is-link is-fullwidth" onclick="addItemGroup()" disabled>Add</button>
                            </div>
                        </nav>
                </div>
                <div class="column is-one-fifth">
                    <nav class="panel">
                            <p class="panel-heading has-text-centered" element-type="item" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Items</p>
                            <div class="tree-panel-blocks" id="item-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">
                            </div>
                            <div class="panel-block panel-block-add" id="items-add-button">
                                <button class="button is-link is-fullwidth" onclick="addItem()" disabled>Add</button>
                            </div>
                        </nav>
                </div>
                <div class="column is-one-fifth">
                    <nav class="panel">
                            <p class="panel-heading has-text-centered" element-type="codelistitem" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">Choices</p>
                            <div class="tree-panel-blocks" id="code-list-item-panel-blocks" ondragenter="allowDrop(event)" ondragover="allowDrop(event)" ondrop="elementDrop(event)">
                            </div>
                            <div class="panel-block panel-block-add" id="code-list-items-add-button">
                                <button class="button is-link is-fullwidth" onclick="addCodeListItem()" disabled>Add</button>
                            </div>
                        </nav>
                </div>
            </div>
        </section>

        <section class="section is-hidden" id="clinicaldata-section">
            <div class="columns">
                <div class="column is-one-fifth">
                    <nav class="panel">
                        <p class="panel-heading has-text-centered">Subjects</p>
                        <div class="panel-block">
                            <div class="control has-icons-left">
                                <input class="input" id="search-subject-input" type="text" placeholder="Search">
                                <span class="icon is-left">
                                    <i class="fas fa-search"></i>
                                </span>
                            </div>
                        </div>
                        <div class="tree-panel-blocks" id="subject-panel-blocks">
                            <div class="panel-block has-text-centered has-text-grey-light" id="no-subjects-hint">
                                <p>No subjects available. Please add a new subject with the button below.</p>
                            </div>
                        </div>
                        <div class="panel-block panel-block-add">
                            <div class="field is-grouped is-fullwidth">
                                <div class="control is-expanded has-icons-left">
                                    <span class="icon is-left">
                                        <i class="fas fa-plus"></i>
                                    </span>
                                    <input class="input" id="add-subject-input" type="text" placeholder="New subject">
                                </div>
                                <div class="control">
                                    <button class="button is-link" onclick="addSubject()">Add</button>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>
                <div class="column is-one-fifth">
                    <nav class="panel">
                        <p class="panel-heading has-text-centered">Events</p>
                        <div class="tree-panel-blocks" id="clinical-data-study-event-panel-blocks">
                        </div>
                    </nav>
                </div>
                <div class="column is-one-fifth">
                    <nav class="panel">
                        <p class="panel-heading has-text-centered">Forms</p>
                        <div class="tree-panel-blocks" id="clinical-data-forms-panel-blocks">
                        </div>
                    </nav>
                </div>
                <div class="column is-two-fifths">
                    <nav class="panel">
                        <p class="panel-heading has-text-centered">Data</p>
                        <div class="tree-panel-blocks" id="clinical-data-study-event-panel-blocks">
                        </div>
                    </nav>
                </div>
            </div>
        </section>

        <div class="modal" id="warning-modal">
            <div class="modal-background"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle"></h2>
                    <p></p>
                    <br>
                    <button class="button is-small is-link">Okay</button>
                </div>
            </div>
        </div>

        <div class="modal" id="delete-modal">
            <div class="modal-background" onclick="hideDeleteModal()"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle">Please confirm</h2>
                    <p>The reference to the element will be removed. The element definition will be removed as well if there was no other reference to it.</p>
                    <br>
                    <button class="button is-danger is-small" onclick="deleteElement()">Remove</button>
                    <button class="button is-small" onclick="hideDeleteModal()">Cancel</button>
                </div>
            </div>
        </div>

        <div class="modal" id="duplicate-modal">
            <div class="modal-background" onclick="hideDuplicateModal()"></div>
            <div class="modal-content is-medium">
                <div class="box has-text-centered">
                    <h2 class="subtitle">Mode of duplication</h2>
                    <p>It possible to either duplicate the reference to the elements definition, to create a new shallow copy with the same children references, or to recursively deep copy the element and all its descendants.</p>
                    <br>
                    <p><strong>Hint:</strong> If you create a reference, the original element and its descendants are updated if you make changes in the new element. A shallow or deep copy lets you make changes that do not affect the original element (shallow) and its descendants (deep). In a shallow copy you can still rearrange, remove, or add direct children references without affecting the original element.</p>
                    <br>
                    <div class="buttons is-centered">
                        <button class="button is-small is-link" onclick="duplicateReference()">Reference</button>
                        <button class="button is-small is-link" onclick="shallowOrDeepCopy(false)">Shallow copy</button>
                        <button class="button is-small is-link" onclick="shallowOrDeepCopy(true)">Deep copy</button>
                        <button class="button is-small" onclick="hideDuplicateModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="more-modal">
            <div class="modal-background" onclick="hideMoreModal()"></div>
            <div class="modal-content is-more-modal">
                <div class="box">
                    <div class="tabs is-centered" id="more-tabs">
                        <ul>
                            <li class="is-active" id="element-options-tab" onclick="moreTabClicked(event)"><a>Element Options</a></li>
                            <li id="element-description-tab" onclick="moreTabClicked(event)"><a>Element Description</a></li>
                            <li id="conditions-tab" onclick="moreTabClicked(event)"><a>Conditions</a></li>
                            <li id="measurement-units-tab" onclick="moreTabClicked(event)"><a>Measurement Units</a></li>
                        </ul>
                    </div>
                    <div class="columns is-centered" id="element-options">
                        <div class="column is-three-quarters">
                            <div class="field">
                                <label class="label" id="condition-label">Collection Exception Condition</label>
                            </div>
                            <div class="field">
                                <label class="label" id="measurement-unit-label">Measurement Unit</label>
                            </div>
                            <label class="label" id="range-check-label">Range Check</label>
                            <button class="button is-small is-pulled-right" id="add-range-check-button" onclick="addRangeCheckInput()">+</button>
                            <br>
                            <label class="label" id="alias-label">Alias</label>
                            <div class="buttons is-pulled-right are-small">
                                <button class="button" onclick="addAliasInput()">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="columns is-centered is-hidden" id="element-description">
                        <div class="column is-three-quarters">
                            <div class="notification is-success">
                                This system is built for good usability while also encouraging best practices.
                                Therefore, the main details panel does not show the description of an item but its question instead.
                                If required, the description of an item can be edited here.
                            </div>
                            <label class="label" id="element-description-label">Description</label>
                            <textarea class="textarea" id="element-description-textarea"></textarea>
                        </div>
                    </div>
                    <div class="columns is-centered is-hidden" id="conditions">
                        <div class="column is-three-quarters">
                            <div class="notification is-success">
                                Conditions are used to define a collection exception for an item.
                                The system automatically hides an item if the specified condition evaluates to true.
                                <strong>Example:</strong> To hide an item with the OID <i>ispregnant</i> if the CodedValue or Text of another item with the OID <i>gender</i> is not set to <i>female</i>, enter <i><u>gender != "female"</u></i> and reference it in the <i>ispregnant</i> item.
                            </div>
                            <label class="label" id="conditions-label">Collection Exception Conditions</label>
                            <button class="button is-small is-pulled-right" onclick="addConditionInput()">+</button>
                        </div>
                    </div>
                    <div class="columns is-centered is-hidden" id="measurement-units">
                        <div class="column is-three-quarters">
                            <div class="notification is-success">
                                Measurement units defined here are available for each item in every study event.
                                The symbol is a translated text and corresponds to the current selected language.
                            </div>
                            <label class="label" id="measurement-units-label">Measurement Units</label>
                            <button class="button is-small is-pulled-right" onclick="addMeasurementUnitInput()">+</button>
                        </div>
                    </div>
                    <div class="columns is-centered">
                        <div class="column is-three-quarters">
                            <div class="buttons">
                                <button class="button is-link" id="save-more-button" onclick="saveMoreModal()">Save Changes</button>
                                <button class="button" id="cancel-more-button" onclick="hideMoreModal()">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal is-active" id="start-modal">
            <div class="modal-background"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="columns is-centered">
                        <div class="column is-two-thirds">
                            <h1 class="title">OpenEDC – Start</h1>
                            <h2 class="subtitle">Please choose a starting point</h2>
                            <hr>
                            <p>This free and open-source electronic data capture (EDC) system lets you create and conduct simple medical research studies based on the <a target="_blank" href="https://www.cdisc.org/standards/data-exchange/odm">CDISC ODM-XML</a> format. This EDC system can be used to design electronic case report forms as well as to collect and archive clinical research data.</p>
                            <br>
                            <p>Below you can find three different starting points. For a new and empty project, choose <strong>New Project</strong>. If you have an ODM-XML file on your computer, choose <strong>Open</strong>. If you have not yet used this EDC system, choose <strong>Example</strong> to load an exemplary project.</p>
                            <br>
                            <div class="buttons is-centered">
                                <button class="button" onclick="newProject()">New Project</button>
                                <div class="file">
                                    <label class="file-label">
                                        <input class="file-input" type="file" name="resume" id="odm-upload" onchange="uploadODM()">
                                        <span class="file-cta">
                                            <span class="file-label">Open</span>
                                        </span>
                                    </label>
                                </div>
                                <button class="button" onclick="loadExample()">Example</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="project-modal">
            <div class="modal-background" onclick="hideProjectModal()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="tabs is-centered" id="project-tabs">
                        <ul>
                            <li class="is-active" id="general-options-tab" onclick="projectTabClicked(event)"><a>General Options</a></li>
                            <li id="users-locations-tab" onclick="projectTabClicked(event)"><a>Users and Locations</a></li>
                            <li id="name-description-tab" onclick="projectTabClicked(event)"><a>Name and Description</a></li>
                        </ul>
                    </div>
                    <div class="columns is-centered">
                        <div class="column is-three-quarters" id="general-options">
                            General Options
                        </div>
                        <div class="column is-three-quarters is-hidden" id="users-locations">
                            Users and Locations
                        </div>
                        <div class="column is-three-quarters is-hidden" id="name-description">
                            <div class="field">
                                <label class="label">Study name</label>
                                <input class="input" id="study-name-input" type="text">
                            </div>
                            <div class="field">
                                <label class="label">Study description</label>
                                <textarea class="textarea" id="study-description-textarea"></textarea>
                            </div>
                            <div class="field">
                                <label class="label">Protocol name</label>
                                <input class="input" id="protocol-name-input" type="text">
                            </div>
                        </div>
                    </div>
                    <div class="columns is-centered">
                        <div class="column is-three-quarters">
                            <div class="buttons">
                                <button class="button is-link" id="save-global-variables-button" onclick="saveProjectModal()">Save Changes</button>
                                <button class="button" id="cancel-global-variables-button" onclick="hideProjectModal()">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="about-modal">
            <div class="modal-background" onclick="hideAboutModal()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="columns is-centered">
                        <div class="column is-two-thirds">
                            <h1 class="title">About OpenEDC</h1>
                            <h2 class="subtitle">Part of the <a target="_blank" rel="noopener noreferrer" href="https://medical-data-models.org/?lang=en">MDM Portal</a></h2>
                            <hr>
                            <p>This free and open-source electronic data capture (EDC) system lets you create and conduct simple medical research studies based on the <a target="_blank" href="https://www.cdisc.org/standards/data-exchange/odm">CDISC ODM-XML</a> format. This EDC system can be used to design electronic case report forms as well as to collect and archive clinical research data.</p>
                            <br>
                            <p>The EDC system is currently in a beta, but yet stable state. For any questions, bug reports, or feature requests, please contact:</p>
                            <br>
                            <div class="notification">
                                <p>Leonard Greulich</p>
                                <p>+49 (251) 83-54730</p>
                                <p><a href="mailto:leonard.greulich@ukmuenster.de">leonard.greulich@uni-muenster.de</a></p>
                                <br>
                                <p><strong>Institute for Medical Informatics</strong></p>
                                <p>Director: Prof. Dr. Martin Dugas</p>
                                <p>Albert-Schweitzer-Campus 1, A11</p>
                                <p>48149 Münster, Germany</p>
                            </div>
                            <a class="button is-rounded is-small is-link" target="_blank" href="https://medical-data-models.org/imprint?lang=en#data-privacy">
                                <span class="icon">
                                        <i class="fas fa-arrow-right"></i>
                                </span>
                                <span>Data Protection Policy</span>
                            </a>
                            <br><br>
                            <div class="buttons">
                                <button class="button" onclick="hideAboutModal()">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="preview-modal">
            <div class="modal-background" onclick="hidePreviewModal()"></div>
            <div class="modal-content is-large">
                <div class="box">
                    <div class="columns is-centered">
                        <div class="column is-two-thirds" id="preview-column">
                            <button id="preview-fs-button" class="button is-rounded is-small is-white has-text-grey-light is-pulled-right" onclick="togglePreviewFS()">
                                <span class="icon">
                                    <i class="fas fa-expand"></i>
                                </span>
                            </button>
                            <h1 class="title" id="preview-form-title"></h1>
                            <hr>
                            <div id="preview-content"></div>
                            <button class="button" id="preview-close-button" onclick="hidePreviewModal()" internationalization="Close">Close</button>
                            <div class="field has-addons is-pulled-right">
                                <div class="control">
                                    <button class="button" id="preview-previous-button" onclick="loadPreviousFormPreview()" internationalization="Back">Back</button>
                                </div>
                                <div class="control">
                                    <button class="button is-link" id="preview-next-button" onclick="loadNextFormPreview()" internationalization="Continue">Continue</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
